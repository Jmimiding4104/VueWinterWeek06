import{_ as $,M as P,o as r,c as i,a as t,t as a,b as f,v as y,r as p,f as c,g as V,n as b,w as k,F as g,e as v,i as A,j as M,k as x,h as U,l as T}from"./index-062e1918.js";const w={props:["id"],data(){return{productModal:"",product:{},qty:1}},watch:{id(){this.getProduct()}},methods:{openModal(){this.productModal.show()},closeModal(){this.productModal.hide()},getProduct(){this.$http.get(`${{}.VUE_APP_API}/api/${{}.VUE_APP_PATH}/product/${this.id}`).then(s=>{this.product=s.data.product}).catch(()=>{alert("異常情況，請重試~")})},addToCart(){this.$emit("add-to-cart",this.product.id,this.qty),this.closeModal()}},mounted(){this.productModal=new P(this.$refs.productModal)}},E={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"productModal"},I={class:"modal-dialog modal-xl",role:"document"},q={class:"modal-content border-0"},F={class:"modal-header bg-dark text-white"},L={class:"modal-title",id:"exampleModalLabel"},D=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),H={class:"modal-body"},N={class:"row"},S={class:"col-sm-6"},z=["src"],B={class:"col-sm-6"},j={class:"badge bg-primary rounded-pill"},J={key:0,class:"h5"},O={key:1},G={class:"h6"},K={class:"h5"},Q={class:"input-group"};function R(s,o,_,C,e,n){return r(),i("div",E,[t("div",I,[t("div",q,[t("div",F,[t("h5",L,[t("span",null,a(e.product.title),1)]),D]),t("div",H,[t("div",N,[t("div",S,[t("img",{class:"img-fluid",src:e.product.imageUrl,alt:""},null,8,z)]),t("div",B,[t("span",j,a(e.product.category),1),t("p",null,"商品描述："+a(e.product.description),1),t("p",null,"商品內容："+a(e.product.content),1),e.product.price===e.product.origin_price?(r(),i("div",J,a(e.product.price)+" 元 ",1)):(r(),i("div",O,[t("del",G,"原價 "+a(e.product.origin_price)+" 元",1),t("div",K,"現在只要 "+a(e.product.price)+" 元",1)])),t("div",null,[t("div",Q,[f(t("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":o[0]||(o[0]=u=>e.qty=u)},null,512),[[y,e.qty]]),t("button",{type:"button",class:"btn btn-primary",onClick:o[1]||(o[1]=(...u)=>n.addToCart&&n.addToCart(...u))}," 加入購物車 ")])])])])])])])],512)}const W=$(w,[["render",R]]),X={data(){return{form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{isPhone(s){return/^(09)[0-9]{8}$/.test(s)?!0:"需要正確的電話號碼"},sendOrder(){const s=`${{}.VUE_APP_API}/api/${{}.VUE_APP_PATH}/order`,o={user:this.form.user,message:this.form.message};this.$http.post(s,{data:o}).then(_=>{alert(_.data.message),this.$refs.form.resetForm()}).catch(()=>{alert("異常情況，請重試~")})}}},Y={class:"my-5 row justify-content-center"},Z={class:"mb-3"},tt=t("label",{for:"email",class:"form-label"},"Email",-1),et={class:"mb-3"},st=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),ot={class:"mb-3"},lt=t("label",{for:"phone",class:"form-label"},"收件人手機",-1),at={class:"mb-3"},dt=t("label",{for:"address",class:"form-label"},"收件人地址",-1),nt={class:"mb-3"},rt=t("label",{for:"message",class:"form-label"},"留言",-1),it={class:"text-end"};function ct(s,o,_,C,e,n){const u=p("VField"),m=p("error-message"),l=p("VForm");return r(),i("div",Y,[c(l,{ref:"form",class:"col-md-6"},{default:V(({errors:d})=>[t("div",Z,[tt,c(u,{id:"email",name:"email",type:"email",class:b(["form-control",{"is-invalid":d.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:e.form.user.email,"onUpdate:modelValue":o[0]||(o[0]=h=>e.form.user.email=h)},null,8,["class","modelValue"]),c(m,{name:"email",class:"invalid-feedback"})]),t("div",et,[st,c(u,{id:"name",name:"姓名",type:"text",class:b(["form-control",{"is-invalid":d.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:e.form.user.name,"onUpdate:modelValue":o[1]||(o[1]=h=>e.form.user.name=h)},null,8,["class","modelValue"]),c(m,{name:"姓名",class:"invalid-feedback"})]),t("div",ot,[lt,c(u,{id:"phone",name:"手機",type:"text",class:b(["form-control",{"is-invalid":d.手機}]),placeholder:"請輸入手機",rules:n.isPhone,modelValue:e.form.user.tel,"onUpdate:modelValue":o[2]||(o[2]=h=>e.form.user.tel=h)},null,8,["class","rules","modelValue"]),c(m,{name:"手機",class:"invalid-feedback"})]),t("div",at,[dt,c(u,{id:"address",name:"地址",type:"text",class:b(["form-control",{"is-invalid":d.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:e.form.user.address,"onUpdate:modelValue":o[3]||(o[3]=h=>e.form.user.address=h)},null,8,["class","modelValue"]),c(m,{name:"地址",class:"invalid-feedback"})]),t("div",nt,[rt,f(t("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":o[4]||(o[4]=h=>e.form.message=h)},null,512),[[y,e.form.message]])]),t("div",it,[t("button",{type:"submit",class:"btn btn-danger",onClick:o[5]||(o[5]=k(h=>n.sendOrder(),["prevent"]))}," 送出訂單 ")])]),_:1},512)])}const ut=$(X,[["render",ct]]),ht={data(){return{cartData:{},products:[],product:{},deleteAllCarts:{},cart:{},productId:"",form:{user:{email:"",name:"",address:"",tel:""},message:""}}},components:{CartForm:ut,CartModal:W},methods:{getProducts(){this.$http.get("https://vue3-course-api.hexschool.io/v2/api/Jmimiding4104/products/all").then(s=>{this.products=s.data.products}).catch(()=>{alert("異常情況，請重試~")})},getCarts(){this.$http.get("https://vue3-course-api.hexschool.io/v2/api/Jmimiding4104/cart").then(s=>{this.cartData=s.data.data}).catch(()=>{alert("異常情況，請重試~")})},addToCart(s,o=1){const _={product_id:s,qty:o};this.$http.post(`${{}.VUE_APP_API}/api/${{}.VUE_APP_PATH}/cart`,{data:_}).then(()=>{this.getCarts()}).catch(()=>{alert("異常情況，請重試~")})},delCartItem(s){this.$http.delete(`${{}.VUE_APP_API}/api/${{}.VUE_APP_PATH}/cart/${s}`).then(()=>{this.getCarts()}).catch(()=>{alert("異常情況，請重試~")})},delCarts(){this.$http.delete(`${{}.VUE_APP_API}/api/${{}.VUE_APP_PATH}/carts`).then(s=>{alert("已成功清除購物車"),this.getCarts()}).catch(()=>{alert("異常情況，請重試~")})},updateCarts(s){const o={product_id:s.id,qty:s.qty};this.isLoading=s.id,this.$http.put(`${{}.VUE_APP_API}/api/${{}.VUE_APP_PATH}/cart/${s.id}`,{data:o}).then(()=>{this.getCarts()}).catch(()=>{alert("異常情況，請重試~")})},openModal(s){this.$refs.CartModal.openModal(),this.productId=s,this.$refs.CartModal.getProduct()}},mounted(){this.getProducts(),this.getCarts()}},_t=t("h2",null,"購物車",-1),mt={class:"container"},pt={class:"mt-4"},bt={class:"table align-middle"},gt=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"商品名稱"),t("th",null,"價格"),t("th")])],-1),ft={style:{width:"200px"}},vt={key:0,class:"h5"},$t={key:1},Ct={class:"h6"},yt={class:"h5"},Pt={class:"btn-group btn-group-sm"},Vt=["onClick"],kt=["onClick","disabled"],At={class:"spinner-border spinner-border-sm"},Mt={class:"text-end"},xt={class:"table align-middle"},Ut=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",null,"單價")])],-1),Tt=["onClick","disabled"],wt={class:"input-group input-group-sm"},Et={class:"input-group mb-3"},It=["onUpdate:modelValue","onChange","disabled"],qt=["value"],Ft={class:"input-group-text",id:"basic-addon2"},Lt={class:"text-end"},Dt=t("td",{colspan:"3",class:"text-end"},"總計",-1),Ht={class:"text-end"};function Nt(s,o,_,C,e,n){const u=p("CartModal"),m=p("CartForm");return r(),i(g,null,[_t,t("div",mt,[t("div",pt,[c(u,{ref:"CartModal",id:e.productId,onAddToCart:n.addToCart},null,8,["id","onAddToCart"]),t("table",bt,[gt,t("tbody",null,[(r(!0),i(g,null,v(e.products,l=>(r(),i("tr",{key:l.id},[t("td",ft,[t("div",{style:M([{backgroundImage:`url(${l.imageUrl})`},{height:"100px","background-size":"cover","background-position":"center"}])},null,4)]),t("td",null,a(l.title),1),t("td",null,[l.price===l.origin_price?(r(),i("div",vt,a(l.price)+" 元 ",1)):(r(),i("div",$t,[t("del",Ct,"原價 "+a(l.origin_price)+" 元",1),t("div",yt,"現在只要 "+a(l.price)+" 元",1)]))]),t("td",null,[t("div",Pt,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:d=>n.openModal(l.id)}," 查看更多 ",8,Vt),t("button",{type:"button",class:"btn btn-outline-danger",onClick:d=>n.addToCart(l.id),disabled:s.isLoading===l.id},[f(t("span",At,null,512),[[x,s.isLoading===l.id]]),U(" 加到購物車 ")],8,kt)])])]))),128))])]),t("div",Mt,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:o[0]||(o[0]=l=>n.delCarts())}," 清空購物車 ")]),t("table",xt,[Ut,t("tbody",null,[e.cartData.carts?(r(!0),i(g,{key:0},v(e.cartData.carts,l=>(r(),i("tr",{key:l.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:d=>n.delCartItem(l.id),disabled:s.isLoading===l.id}," x ",8,Tt)]),t("td",null,a(l.product.title),1),t("td",null,[t("div",wt,[t("div",Et,[f(t("select",{id:"",class:"form-select","onUpdate:modelValue":d=>l.qty=d,onChange:d=>n.updateCarts(l),disabled:s.isLoading===l.id},[(r(),i(g,null,v(100,d=>t("option",{value:d,key:`${d}${l.id}`},a(d),9,qt)),64))],40,It),[[T,l.qty]]),t("span",Ft,a(l.product.unit),1)])])]),t("td",Lt,a(l.final_total),1)]))),128)):A("",!0)]),t("tfoot",null,[t("tr",null,[Dt,t("td",Ht,a(e.cartData.total),1)])])])]),c(m)])],64)}const zt=$(ht,[["render",Nt]]);export{zt as default};
