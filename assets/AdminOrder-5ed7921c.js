import{_ as y,M as x,o as l,c as a,a as t,t as o,F as _,e as g,b as C,m as w,h as k,r as $,f,n as D,i as L}from"./index-062e1918.js";import{P as N}from"./PaginationComponent-127eb16b.js";const P={props:["temp-order"],data(){return{orderModal:""}},methods:{updateOrder(){this.$emit("updateOrder",this.tempOrder),this.orderModal.hide()},convertToNT(e){return`NT${e}`},openModal(){this.orderModal.show()}},mounted(){this.orderModal=new x(this.$refs.orderModal)}},S={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"orderModal"},U={class:"modal-dialog modal-xl",role:"document"},J={class:"modal-content border-0"},T=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),V={class:"modal-body"},G={class:"row"},B={class:"col-md-4"},z=t("h3",null,"用戶資料",-1),A={class:"table"},E=t("th",{style:{width:"100px"}},"姓名",-1),F=t("th",null,"Email",-1),I=t("th",null,"電話",-1),j=t("th",null,"地址",-1),q={class:"col-md-8"},H=t("h3",null,"訂單細節",-1),K={class:"table"},Q=t("th",{style:{width:"100px"}},"訂單編號",-1),R=t("th",null,"下單時間",-1),W=t("th",null,"付款時間",-1),X={key:0},Y={key:1},Z=t("th",null,"付款狀態",-1),tt={key:0,class:"text-success"},et={key:1,class:"text-muted"},ot=t("th",null,"總金額",-1),st=t("h3",null,"選購商品",-1),dt={class:"table"},lt=t("thead",null,[t("tr")],-1),at={class:"text-end"},nt={class:"d-flex justify-content-end"},rt={class:"form-check"},it={class:"form-check-label",for:"flexCheckDefault"},ct={key:0},ht={key:1},ut={class:"modal-footer"},pt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function _t(e,s,i,O,h,r){var u,m,b,d,p,n,v,M;return l(),a("div",S,[t("div",U,[t("div",J,[T,t("div",V,[t("div",G,[t("div",B,[z,t("table",A,[t("tbody",null,[t("tr",null,[E,t("td",null,o((m=(u=e.tempOrder)==null?void 0:u.user)==null?void 0:m.name),1)]),t("tr",null,[F,t("td",null,o((d=(b=e.tempOrder)==null?void 0:b.user)==null?void 0:d.email),1)]),t("tr",null,[I,t("td",null,o((n=(p=e.tempOrder)==null?void 0:p.user)==null?void 0:n.tel),1)]),t("tr",null,[j,t("td",null,o((M=(v=e.tempOrder)==null?void 0:v.user)==null?void 0:M.address),1)])])])]),t("div",q,[H,t("table",K,[t("tbody",null,[t("tr",null,[Q,t("td",null,o(e.tempOrder.id),1)]),t("tr",null,[R,t("td",null,o(new Date(e.tempOrder.create_at*1e3).toLocaleDateString()),1)]),t("tr",null,[W,t("td",null,[e.tempOrder.paid_date?(l(),a("span",X,o(new Date(e.tempOrder.paid_date*1e3).toLocaleDateString()),1)):(l(),a("span",Y))])]),t("tr",null,[Z,t("td",null,[e.tempOrder.is_paid?(l(),a("strong",tt," 已付款 ")):(l(),a("span",et,"尚未付款"))])]),t("tr",null,[ot,t("td",null,o(e.tempOrder.total),1)])])]),st,t("table",dt,[lt,(l(!0),a(_,null,g(e.tempOrder.products,c=>(l(),a("tbody",{key:c.id},[t("tr",null,[t("th",null,o(c.product.title),1),t("td",null,o(c.product.num)+" / "+o(c.product.unit),1),t("td",at,o(r.convertToNT(c.final_total)),1)])]))),128))]),t("div",nt,[t("div",rt,[C(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":s[0]||(s[0]=c=>e.tempOrder.is_paid=c)},null,512),[[w,e.tempOrder.is_paid]]),t("label",it,[e.tempOrder.is_paid?(l(),a("span",ct,"已付款")):(l(),a("span",ht,"未付款"))])])])])])]),t("div",ut,[pt,t("button",{type:"button",class:"btn btn-primary",onClick:s[1]||(s[1]=c=>r.updateOrder())}," 修改付款狀態 ")])])])],512)}const mt=y(P,[["render",_t]]),bt={props:["id","tempOrder"],data(){return{}},methods:{delOrder(){const e=`https://vue3-course-api.hexschool.io/v2/api/Jmimiding4104/admin/order/${this.id}`;this.$http.delete(e).then(()=>{this.delOrderModal.hide(),this.getData()}).catch(()=>{alert("異常情況，請重試~")})},getData(){this.$emit("getData")},openModal(){this.delOrderModal.show()}},mounted(){this.delOrderModal=new x(this.$refs.delOrderModal)}},Ot={id:"delProductModal",ref:"delOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},$t={class:"modal-dialog"},ft={class:"modal-content border-0"},gt=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除訂單")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),yt={class:"modal-body"},vt=t("strong",{class:"text-danger"},null,-1),Mt={class:"modal-footer"},kt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Dt(e,s,i,O,h,r){return l(),a("div",Ot,[t("div",$t,[t("div",ft,[gt,t("div",yt,[k(" 是否刪除 "),vt,k(" "+o(i.tempOrder.title)+"(刪除後將無法恢復)。 ",1)]),t("div",Mt,[kt,t("button",{type:"button",class:"btn btn-danger",onClick:s[0]||(s[0]=u=>r.delOrder())}," 確認刪除 ")])])])],512)}const xt=y(bt,[["render",Dt]]),Ct={data(){return{orders:[],due_date:"",is_paid:"",tempOrder:{},orderId:"",isLoading:!1,pagination:""}},components:{OrderModal:mt,DelOrderModal:xt,PaginationComponent:N},methods:{checkLogin(){const e=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=e,this.$http.post("https://vue3-course-api.hexschool.io/v2/api/user/check").then(()=>{this.getData()}).catch(s=>{alert("請重新登入"),this.$router.push("/")})},getData(e=1){const s=`https://vue3-course-api.hexschool.io/v2/api/Jmimiding4104/admin/orders?page=${e}`;this.$http.get(s,this.tempProduct).then(i=>{this.orders=i.data.orders,this.pagination=i.data.pagination}).catch(()=>{alert("異常情況，請重試~")})},updateOrder(e){const s=`https://vue3-course-api.hexschool.io/v2/api/Jmimiding4104/admin/order/${e.id}`,i={is_paid:e.is_paid};this.$http.put(s,{data:i}).then(O=>{this.getData()}).catch(()=>{alert("異常情況，請重試~")})},openModal(e,s){e==="edit"?(this.tempOrder=JSON.parse(JSON.stringify(s)),this.$refs.OrderModal.openModal()):e==="del"&&(this.tempOrder=JSON.parse(JSON.stringify(s)),this.$refs.DelOrderModal.openModal(),this.orderId=s.id)}},mounted(){this.checkLogin()}},wt={class:"container"},Lt={class:"table mt-4"},Nt=t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"電子信箱"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),Pt={class:"list-unstyled"},St={class:"form-check form-switch"},Ut=["onUpdate:modelValue","onChange"],Jt={class:"form-check-label",for:"paid"},Tt={class:"btn-group"},Vt=["onClick"],Gt=["onClick"];function Bt(e,s,i,O,h,r){const u=$("PaginationComponent"),m=$("OrderModal"),b=$("DelOrderModal");return l(),a(_,null,[t("div",wt,[t("table",Lt,[Nt,t("tbody",null,[(l(!0),a(_,null,g(h.orders,d=>{var p;return l(),a(_,{key:d.id},[h.orders.length?(l(),a("tr",{key:0,class:D({"text-secondary":!d.is_paid})},[t("td",null,o(new Date(d.create_at*1e3).toLocaleDateString()),1),t("td",null,o((p=d.user)==null?void 0:p.email),1),t("td",null,[t("ul",Pt,[(l(!0),a(_,null,g(d.products,n=>(l(),a("li",{key:n.id},o(n.product.title)+" 數量："+o(n.qty)+" "+o(n.product.unit),1))),128))])]),t("td",null,o(d.total),1),t("td",null,[t("div",St,[C(t("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"paid","onUpdate:modelValue":n=>d.is_paid=n,onChange:n=>r.updateOrder(d)},null,40,Ut),[[w,d.is_paid]]),t("label",Jt,[t("span",{class:D({"text-success":d.is_paid,"text-danger":!d.is_paid})},o(d.is_paid?"已付款":"未付款"),3)])])]),t("td",null,[t("div",Tt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:n=>r.openModal("edit",d)}," 檢視 ",8,Vt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:n=>r.openModal("del",d)}," 刪除 ",8,Gt)])])],2)):L("",!0)],64)}),128))])])]),f(u,{pagination:h.pagination,onGetData:r.getData},null,8,["pagination","onGetData"]),f(m,{"temp-order":h.tempOrder,onUpdateOrder:r.updateOrder,ref:"OrderModal"},null,8,["temp-order","onUpdateOrder"]),f(b,{"temp-order":h.tempOrder,onGetData:r.getData,ref:"DelOrderModal"},null,8,["temp-order","onGetData"])],64)}const Et=y(Ct,[["render",Bt]]);export{Et as default};
